     1                                  ; Daniel Mitchell
     2                                  ; Surprise - P7
     3                                  ; October 23, 2020
     4                                  ; Should be interesting
     5                                  
     6                                  SECTION .data
     7                                  ; define data/variables here.  Think DB, DW, DD, DQ
     8                                  COLS: EQU 80
     9                                  ROWS: EQU 24
    10 00000000 0A                      skipChar: DB 10
    11                                  lenSkipChar: EQU ($ - skipChar)
    12 00000001 2E2F75313233793536-     surprise:  db  46, 47, 117, 49, 50, 51, 121, 53, 54, 55, 56, 57, 58, 59, 60, 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71, 72, 73, 74, 75, 76, 77, 78, 79, 80, 81, 82, 83, 84, 122, 123, 124, 88, 89, 90, 91, 92, 93, 94,
    13 0000000A 3738393A3B3C3D3E3F-
    14 00000013 404142434445464748-
    15 0000001C 494A4B4C4D4E4F5051-
    16 00000025 5253547A7B7C58595A-
    17 0000002E 5B5C5D5E5F60616263-
    18 00000037 6465666768696A6B6C-
    19 00000040 6D6E6F707172737475-
    20 00000049 767778797A7B7C7D2E-
    21 00000052 2F3076327834353637-
    22 0000005B 38393A3B3C3D3E3F40-
    23 00000064 414243444546474849-
    24 0000006D 4A4B4C4D4E4F505152-
    25 00000076 53547A7B7C58595A5B-
    26 0000007F 5C5D5E5F6061626364-
    27 00000088 65666768696A6B6C6D-
    28 00000091 6E6F70717273747576-
    29 0000009A 7778797A7B7C7D2E74-
    30 000000A3 75765778797A363738-
    31 000000AC 393A3B3C3D3E3F4041-
    32 000000B5 42434445464748494A-
    33 000000BE 4B4C4D4E4F50515253-
    34 000000C7 54556F5758595A5B5C-
    35 000000D0 5D5E5F606162636465-
    36 000000D9 666768696A6B6C6D6E-
    37 000000E2 6F7071727374757677-
    38 000000EB 78797A7B7C7D2E2F30-
    39 000000F4 763278343536373839-
    40 000000FD 3A3B3C3D3E3F404142-
    41 00000106 434445464748494A4B-
    42 0000010F 4C4D4E4F5051525354-
    43 00000118 6E6A7058595A5B5C5D-
    44 00000121 5E5F60616263646566-
    45 0000012A 6768696A6B6C6D6E6F-
    46 00000133 707172737475767778-
    47 0000013C 797A7B7C7D2E2F7531-
    48 00000145 32337935363738393A-
    49 0000014E 3B3C3D3E3F40414243-
    50 00000157 4445464748494A4B4C-
    51 00000160 4D4E4F505152536D79-
    52 00000169 6F8271595A5B5C5D5E-
    53 00000172 5F6061626364656667-
    54 0000017B 68696A6B6C6D6E6F70-
    55 00000184 717273747576777879-
    56 0000018D 7A7B7C7D2E2F303132-
    57 00000196 333435363738393A3B-
    58 0000019F 3C3D3E3F4041424344-
    59 000001A8 45464748494A4B4C4D-
    60 000001B1 4E4F5051526C6D6E7F-
    61 000001BA 7077725A5B5C5D5E5F-
    62 000001C3 606162636465666768-
    63 000001CC 696A6B6C6D6E6F7071-
    64 000001D5 72737475767778797A-
    65 000001DE 7B7C7D2E2F30313233-
    66 000001E7 3435363738393A3B3C-
    67 000001F0 3D3E3F404142434445-
    68 000001F9 464748494A4B4C4D4E-
    69 00000202 4F50516B6C7D6E6F6B-
    70 0000020B 7C72735B5C5D5E5F60-
    71 00000214 616263646566676869-
    72 0000021D 6A6B6C6D6E6F707172-
    73 00000226 737475767778797A7B-
    74 0000022F 7C7D2E2F3031323334-
    75 00000238 35363738393A3B3C3D-
    76 00000241 3E3F40414243444546-
    77 0000024A 4748494A4B4C4D4E4F-
    78 00000253 506A6B7E7F6E6F706C-
    79 0000025C 7273745C5D5E5F6061-
    80 00000265 62636465666768696A-
    81 0000026E 6B6C6D6E6F70717273-
    82 00000277 7475767778797A7B7C-
    83 00000280 7D2E2F303132333435-
    84 00000289 363738393A3B3C3D3E-
    85 00000292 3F4041424344454647-
    86 0000029B 48494A4B4C4D4E4F69-
    87 000002A4 706B6C6D7E6F707184-
    88 000002AD 7E74755D5E5F606162-
    89 000002B6 636465666768696A6B-
    90 000002BF 6C6D6E6F7071727374-
    91 000002C8 75767778797A7B7C7D-
    92 000002D1 2E2F30313233343536-
    93 000002DA 3738393A3B3C3D3E3F-
    94 000002E3 404142434445464748-
    95 000002EC 494A4B4C4D4E68696A-
    96 000002F5 6B726D6E6F706C7273-
    97 000002FE 8475765E5F60616263-
    98 00000307 6465666768696A6B6C-
    99 00000310 6D6E6F707172737475-
   100 00000319 767778797A7B7C7D2E-
   101 00000322 2F3031323334353637-
   102 0000032B 38393A3B3C3D3E3F40-
   103 00000334 414243444546474849-
   104 0000033D 4A4B4C4D676369756B-
   105 00000346 6C6D6E6F7071727384-
   106 0000034F 7576775F6061626364-
   107 00000358 65666768696A6B6C6D-
   108 00000361 6E6F70717273747576-
   109 0000036A 7778797A7B7C7D2E2F-
   110 00000373 303132333435363738-
   111 0000037C 393A3B3C3D3E3F4041-
   112 00000385 42434445464748494A-
   113 0000038E 4B4C666768696A6B6C-
   114 00000397 6D6E6F708384737475-
   115 000003A0 767778606162636465-
   116 000003A9 666768696A6B6C6D6E-
   117 000003B2 6F7071727374757677-
   118 000003BB 78797A7B7C7D2E2F30-
   119 000003C4 313233343536373839-
   120 000003CD 3A3B3C3D3E3F404142-
   121 000003D6 434445464748494A4B-
   122 000003DF 6578676869656B6C6D-
   123 000003E8 796F706C7273847576-
   124 000003F1 7D7879616263646566-
   125 000003FA 6768696A6B6C6D6E6F-
   126 00000403 707172737475767778-
   127 0000040C 797A7B7C7D2E2F3031-
   128 00000415 32333435363738393A-
   129 0000041E 3B3C3D3E3F40414243-
   130 00000427 4445464748494A6465-
   131 00000430 667768696A7D6C6D6E-
   132 00000439 7F7071727374758177-
   133 00000442 78747A626364656667-
   134 0000044B 68696A6B6C6D6E6F70-
   135 00000454 717273747576777879-
   136 0000045D 7A7B7C7D2E2F303132-
   137 00000466 333435363738393A3B-
   138 0000046F 3C3D3E3F4041424344-
   139 00000478 4546474849636A6566-
   140 00000481 676E696A6B6C6D6E6F-
   141 0000048A 707172737A75767778-
   142 00000493 747A7B636465666768-
   143 0000049C 696A6B6C6D6E6F7071-
   144 000004A5 72737475767778797A-
   145 000004AE 7B7C7D2E2F30313233-
   146 000004B7 3435363738393A3B3C-
   147 000004C0 3D3E3F404142434445-
   148 000004C9 464748626364656672-
   149 000004D2 68696A6B6C6D7E6F70-
   150 000004DB 716D7374758677788B-
   151 000004E4 7A7B7C646566676869-
   152 000004ED 6A6B6C6D6E6F707172-
   153 000004F6 737475767778797A7B-
   154 000004FF 7C7D2E2F3031323334-
   155 00000508 35363738393A3B3C3D-
   156 00000511 3E3F40414243444546-
   157 0000051A 476162636460667968-
   158 00000523 696A666C6D6E6F8283-
   159 0000052C 72737475767778797A-
   160 00000535 817C7D65666768696A-
   161 0000053E 6B6C6D6E6F70717273-
   162 00000547 7475767778797A7B7C-
   163 00000550 7D2E2F303132333435-
   164 00000559 363738393A3B3C3D3E-
   165 00000562 3F4041424344454660-
   166 0000056B 616263746066676869-
   167 00000574 6A6B6C686E6F707C72-
   168 0000057D 737475767788797A7B-
   169 00000586 7C7D7E666768696A6B-
   170 0000058F 6C6D6E6F7071727374-
   171 00000598 75767778797A7B7C7D-
   172 000005A1 2E2F30313233343536-
   173 000005AA 3738393A3B3C3D3E3F-
   174 000005B3 4041424344455F6061-
   175 000005BC 6263646B666768696A-
   176 000005C5 716C6D6E6F70717273-
   177 000005CE 747B76777879857B7C-
   178 000005D7 7D7E7F6768696A6B6C-
   179 000005E0 6D6E6F707172737475-
   180 000005E9 767778797A7B7C7D2E-
   181 000005F2 2F3031323334353637-
   182 000005FB 38393A3B3C3D3E3F40-
   183 00000604 414243445E5F606162-
   184 0000060D 696465667968697A6B-
   185 00000616 776D6E6F706C727374-
   186 0000061F 7576778A797A7B7C7D-
   187 00000628 7E7F8068696A6B6C6D-
   188 00000631 6E6F70717273747576-
   189 0000063A 7778797A7B7C7D2E2F-
   190 00000643 303132333435363738-
   191 0000064C 393A3B3C3D3E3F4041-
   192 00000655 42435D5E5F60716263-
   193 0000065E 7665666778696A6B6C-
   194 00000667 6D6E6F708372738475-
   195 00000670 7677788B7A7B777D7E-
   196 00000679 858081696A6B6C6D6E-
   197 00000682 6F7071727374757677-
   198 0000068B 78797A7B7C7D2E2F30-
   199 00000694 313233343536373839-
   200 0000069D 3A3B3C3D3E3F404142-
   201 000006A6 5C5D595F7061626364-
   202 000006AF 656667686F6A6B6C68-
   203 000006B8 6E6F70718273747576-
   204 000006C1 727879857B7C837E7F-
   205 000006CA 8B81826A6B6C6D6E6F-
   206 000006D3 707172737475767778-
   207 000006DC 797A7B7C7D2E2F3031-
   208 000006E5 32333435363738393A-
   209 000006EE 3B3C3D3E3F40414243-
   210 000006F7 4445464748494A4B4C-
   211 00000700 4D4E4F505152537A7B-
   212 00000709 7C5758595A5B5C5D5E-
   213 00000712 5F6061626364656667-
   214 0000071B 68696A6B6C6D6E6F70-
   215 00000724 717273747576777879-
   216 0000072D 7A7B7C7D2E2F303132-
   217 00000736 333435363738393A3B-
   218 0000073F 3C3D3E3F4041424344-
   219 00000748 45464748494A4B4C4D-
   220 00000751 4E4F505152537A7B7C-
   221 0000075A 5758595A5B5C5D5E5F-
   222 00000763 606162636465666768-
   223 0000076C 696A6B6C6D6E6F7071-
   224 00000775 72737475767778797A-
   225 0000077E 7B7C7D             
   226                                  SECTION .bss
   227                                  ; define uninitialized data here
   228 00000000 <res 00000001>          curr: 		RESB 1
   229 00000001 <res 00000001>          colSum: 	RESB 1
   230 00000002 <res 00000004>          saveECX:	RESD 1
   231                                  
   232                                  
   233                                  SECTION .text
   234                                  global _main
   235                                  _main:
   236                                  
   237 00000000 B918000000              mov	ecx, ROWS
   238 00000005 B8[01000000]            mov	eax, surprise
   239                                  
   240                                  toploop:	;does important things outside the second loop
   241 0000000A BB00000000              mov	ebx, 0	
   242 0000000F 890D[02000000]          mov	[saveECX], ecx
   243 00000015 B950000000              mov	ecx, COLS
   244                                  
   245                                  innerloop:
   246                                  ;eip is segfaulting around here or before printFunc
   247 0000001A 2918                    sub	[eax], ebx
   248 0000001C 50                      push	eax	;so you don't lose values when registers are used in printFunc
   249 0000001D 53                      push	ebx
   250 0000001E 51                      push	ecx
   251                                  
   252                                  
   253 0000001F E822000000              call	printFunc
   254                                  
   255 00000024 59                      pop	ecx
   256 00000025 5B                      pop	ebx
   257 00000026 58                      pop	eax
   258                                  
   259                                  
   260 00000027 43                      inc	ebx
   261 00000028 83C001                  add	eax, 1
   262                                  
   263                                  
   264 0000002B E2ED                    loop innerloop
   265                                  
   266                                  
   267 0000002D E82A000000              call	skipLine
   268 00000032 8B0D[02000000]          mov	ecx, [saveECX]
   269                                  
   270 00000038 E2D0                    loop toploop
   271                                  
   272                                  
   273                                  
   274                                  ;;print return after 80 chars for new row
   275                                  lastBreak:
   276                                  ; Normal termination code
   277 0000003A B801000000              mov eax, 1
   278 0000003F BB00000000              mov ebx, 0
   279 00000044 CD80                    int 80h
   280                                  
   281                                  ;call after each char has its row num subtracted
   282                                  printFunc:
   283 00000046 89C1                    mov	ecx, eax ;curr char, must be done before putting 4 into eax
   284 00000048 50                      push 	eax
   285 00000049 B804000000              mov	eax, 4
   286 0000004E BB01000000              mov	ebx, 1
   287 00000053 BA01000000              mov	edx, 1
   288 00000058 CD80                    int 	80h
   289 0000005A 58                      pop	eax
   290 0000005B C3                      ret 
   291                                  
   292                                  
   293                                  ; call at end of each row
   294                                  skipLine:
   295 0000005C 50                      push 	eax
   296 0000005D B804000000              mov	eax, 4
   297 00000062 BB01000000              mov	ebx, 1
   298 00000067 B9[00000000]            mov	ecx, skipChar 
   299 0000006C BA01000000              mov	edx, lenSkipChar
   300 00000071 CD80                    int 	80h
   301 00000073 58                      pop	eax
   302 00000074 C3                      ret
